<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project Instructions</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="site">
    <a href="index.html" style="display:inline-block;margin-bottom:12px;color:var(--muted);text-decoration:none;">‚Üê Back</a>

    <h2 style="color:var(--primary);margin-bottom:8px;">üìã Project Instructions</h2>
    <p class="lead">Enter a project name (e.g., "deck", "shed", "fence"). Optionally paste a YouTube API key to fetch video tutorials.</p>

    <div class="container" style="margin-top:12px;">
      <div class="form-row">
        <label class="label" for="projectInput">Project name</label>
        <input id="projectInput" class="input" type="text" placeholder="e.g., deck, shed, fence" />
      </div>

      <div class="form-row">
        <label class="label" for="youtubeKey">YouTube API Key (optional)</label>
        <input id="youtubeKey" class="input" type="text" placeholder="Paste API key here to include video results (optional)" />
        <small style="color:var(--muted);">If you use a YouTube key, the browser will call the YouTube Data API directly.</small>
      </div>

      <div style="margin-top:10px;">
        <button class="btn" id="fetchBtn">Get Construction Instructions</button>
      </div>

      <div id="loading" class="container hidden" style="margin-top:12px;color:var(--muted);">
        üîç Searching for construction instructions...
      </div>

      <div id="results" class="container hidden" style="margin-top:12px;"></div>
    </div>
  </div>

<script>
  (function(){
    const fetchBtn = document.getElementById('fetchBtn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');

    const commonProjects = {
      deck: {
        materials: ['Pressure-treated lumber', 'Deck screws', 'Concrete footings', 'Joist hangers'],
        tools: ['Circular saw', 'Drill', 'Level', 'Measuring tape'],
        steps: [
          'Plan and mark the deck layout',
          'Dig holes for footings',
          'Install concrete footings',
          'Install the frame and joists',
          'Install deck boards',
          'Add railings and finishing touches'
        ],
        difficulty: 'Intermediate',
        timeEstimate: '2-3 days'
      },
      shed: {
        materials: ['Plywood sheets', '2x4 lumber', 'Roofing materials', 'Foundation blocks'],
        tools: ['Circular saw', 'Hammer', 'Drill', 'Square'],
        steps: [
          'Prepare the foundation',
          'Build the floor frame',
          'Construct wall frames',
          'Install roof trusses',
          'Add siding and roofing',
          'Install door and windows'
        ],
        difficulty: 'Intermediate to Advanced',
        timeEstimate: '1-2 weeks'
      },
      fence: {
        materials: ['Fence posts', 'Fence panels/boards', 'Concrete mix', 'Gate hardware'],
        tools: ['Post hole digger', 'Level', 'Drill', 'Saw'],
        steps: [
          'Mark property lines and plan layout',
          'Dig post holes',
          'Set posts in concrete',
          'Install rails between posts',
          'Attach fence boards or panels',
          'Install gate if needed'
        ],
        difficulty: 'Beginner to Intermediate',
        timeEstimate: '1-3 days'
      }
    };

    async function searchYouTubeInstructions(projectQuery, apiKey){
      if(!apiKey) return [];
      try {
        const q = encodeURIComponent(`how to build ${projectQuery} DIY tutorial`);
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=5&type=video&order=relevance&q=${q}&key=${encodeURIComponent(apiKey)}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error('YouTube API error: ' + res.statusText);
        const json = await res.json();
        if(!json.items) return [];
        return json.items.map(item => ({
          title: item.snippet.title,
          description: item.snippet.description || '',
          videoId: item.id.videoId,
          url: item.id.videoId ? 'https://www.youtube.com/watch?v=' + item.id.videoId : '',
          thumbnail: item.snippet.thumbnails?.medium?.url || '',
          channel: item.snippet.channelTitle || ''
        }));
      } catch(err){
        console.error(err);
        return [];
      }
    }

    function searchConstructionInfo(projectQuery){
      const results = [];
      const key = Object.keys(commonProjects).find(k => projectQuery.toLowerCase().includes(k));
      if(key){
        results.push({ type:'construction_guide', project:key, data: commonProjects[key] });
      }
      return results;
    }

    function renderResults(data){
      let html = `<div style="text-align:center;margin-bottom:12px;"><h3>üèóÔ∏è Instructions for: ${escapeHtml(data.project)}</h3>
                  <p style="color:var(--muted);">${new Date(data.timestamp).toLocaleString()}</p></div>`;

      // guides
      if(data.instructions.guides && data.instructions.guides.length){
        html += '<div><h4 style="color:var(--primary);">üìã Construction Guide</h4>';
        data.instructions.guides.forEach(g=>{
          const d = g.data;
          html += `<div style="border-left:4px solid rgba(79,70,229,0.14);background:#fbfbff;padding:12px;border-radius:8px;margin:10px 0;">
                    <strong>${capitalize(g.project)} Construction Guide</strong>
                    <div style="margin:8px 0;">
                      <span style="font-weight:700">${escapeHtml(d.difficulty)}</span> ¬∑ ${escapeHtml(d.timeEstimate)}
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px;">
                      <div>
                        <h5 style="color:var(--primary);margin:6px 0;">Materials</h5>
                        <ul>${d.materials.map(it=>`<li>${escapeHtml(it)}</li>`).join('')}</ul>
                      </div>
                      <div>
                        <h5 style="color:var(--primary);margin:6px 0;">Tools</h5>
                        <ul>${d.tools.map(it=>`<li>${escapeHtml(it)}</li>`).join('')}</ul>
                      </div>
                    </div>
                    <div style="margin-top:8px;">
                      <h5 style="color:var(--primary);margin:6px 0;">Steps</h5>
                      <ol>${d.steps.map(s=>`<li>${escapeHtml(s)}</li>`).join('')}</ol>
                    </div>
                   </div>`;
        });
        html += '</div>';
      }

      // videos
      if(data.instructions.videos && data.instructions.videos.length){
        html += '<div><h4 style="color:var(--primary);margin-top:12px;">üé• Video Tutorials</h4>';
        data.instructions.videos.forEach(v=>{
          html += `<div style="background:#f8fafb;padding:10px;border-radius:8px;margin:8px 0;border-left:4px solid #dbeafe;">
                    <strong>${escapeHtml(v.title)}</strong>
                    <div style="color:var(--muted);margin:6px 0;">By: ${escapeHtml(v.channel)}</div>
                    <div style="margin-bottom:6px;color:var(--muted);">${escapeHtml((v.description||'').slice(0,220))}${v.description && v.description.length>220? '...' : ''}</div>
                    ${v.url? `<a href="${escapeAttr(v.url)}" target="_blank" rel="noopener noreferrer">Watch on YouTube ‚Üí</a>` : ''}
                  </div>`;
        });
        html += '</div>';
      }

      // additional resources
      if(data.instructions.additionalResources && data.instructions.additionalResources.length){
        html += `<div style="margin-top:12px;"><h4 style="color:var(--primary);">üîó Additional Resources</h4><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px;margin-top:8px;">`;
        data.instructions.additionalResources.forEach(r=>{
          html += `<div style="background:#fff;padding:10px;border-radius:8px;border:1px solid #eef2ff;">
                <a href="${escapeAttr(r.url)}" target="_blank" rel="noopener noreferrer" style="font-weight:700;color:var(--primary)">${escapeHtml(r.name)}</a>
                <div style="color:var(--muted);margin-top:6px">${escapeHtml(r.description)}</div>
              </div>`;
        });
        html += `</div></div>`;
      }

      results.innerHTML = html;
      results.classList.remove('hidden');
      results.scrollIntoView({behavior:'smooth'});
    }

    // small sanitizers
    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
    function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }
    function capitalize(s){ return s && s[0] ? s[0].toUpperCase()+s.slice(1) : s; }

    fetchBtn.addEventListener('click', async ()=>{
      const project = document.getElementById('projectInput').value.trim();
      const apiKey = document.getElementById('youtubeKey').value.trim();
      if(!project){ alert('Please enter a project name.'); return; }

      fetchBtn.disabled = true;
      loading.classList.remove('hidden');
      results.classList.add('hidden');

      try {
        const [videos, guides] = await Promise.all([
          searchYouTubeInstructions(project, apiKey),
          Promise.resolve(searchConstructionInfo(project))
        ]);

        const data = {
          project,
          timestamp: new Date().toISOString(),
          instructions: {
            videos,
            guides,
            additionalResources: [
              { name: 'Home Depot Project Guides', url: 'https://www.homedepot.com/c/how_to_library', description: 'Comprehensive DIY project guides' },
              { name: "Lowe's How-To Library", url: 'https://www.lowes.com/l/how-to-library', description: 'Step-by-step project instructions' },
              { name: 'Family Handyman', url: 'https://www.familyhandyman.com/', description: 'Professional construction and repair advice' }
            ]
          }
        };

        renderResults(data);

      } catch(err){
        results.innerHTML = `<div style="color:#be123c;"><strong>‚ö†Ô∏è Error:</strong> ${escapeHtml(err.message || String(err))}</div>`;
        results.classList.remove('hidden');
      } finally {
        fetchBtn.disabled = false;
        loading.classList.add('hidden');
      }
    });

  })();
</script>
</body>
</html>
